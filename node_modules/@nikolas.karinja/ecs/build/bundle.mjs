import*as t from"@nikolas.karinja/app-utils";class e{constructor(t){this.Parent=t,this.active=!0,e.prototype.$Props.instance++}destroy(){}initComponent(){}initEntity(){}onUpdate(t,e){}onAnimUpdate(t,e){}get Manager(){return this.Parent.Manager}findEntity(t){return this.Parent.findEntity(t)}getComponent(t){return this.Parent.getComponent(t)}isActive(){return!!this.active}setActive(t=!0){this.active=t}setParent(t){this.Parent=t}update(t,e,s){this.onUpdate(t,e),s&&this.onAnimUpdate(t,e)}}e.prototype.$Props={instance:0,isECSComponent:!0,requires:[]};class s{constructor(){this.dead=!1,this.uuid=t.UUID.generate(),this.name=`ecs-entity#${s.prototype.$Props.instance}`,this.Components={},this.Manager=null,s.prototype.$Props.instance++}async addComponent(t,...e){const s=new t(this,...e);this.Components[s.constructor.name]=s,s.initComponent()}call(t,e,...s){return this.getComponent(t)[e](...s)}destroy(){for(const t in this.Components)this.Components[t].destroy();this.Components=null,this.Parent=null}findEntity(t){return this.Manager.get(t)}getComponent(t){return this.Components[t]}initEntity(){for(const t in this.Components)this.Components[t].initEntity()}setActive(t){this.Manager.setActive(this,t)}setManager(t){this.Manager=t}setName(t){this.name=t}update(t,e,s){for(const n in this.Components)this.Components[n].active&&this.Components[n].update(t,e,s)}}s.prototype.$Props={instance:0,isECSEntity:!0};class n{constructor(){this.ids=0,this.name=`ecs-manager#${n.prototype.$Props.instance}`,this.uuid=t.UUID.generate(),this.Assemblies={},this.Components={},this.Entities={array:[],map:{}},n.prototype.$Props.instance++}add(t,e){e||(e=this.generateName(t)),this.Entities.map[e]=t,this.Entities.array.push(t),t.setManager(this),t.setName(e),t.initEntity()}assemble(t,e,s){const n=s.assemblyArgs?s.assemblyArgs:[],i=new e(...s.entityArgs?s.entityArgs:[]),a=s.entityName?s.entityName:this.generateName(i);this.Assemblies[t](i,...n),this.add(i,a)}async assembleAsync(t,e,s={}){const n=s.assemblyArgs?s.assemblyArgs:[],i=new e(...s.entityArgs?s.entityArgs:[]),a=s.entityName?s.entityName:this.generateName(i);await this.Assemblies[t](i,...n),this.add(i,a)}createAssembly(t,e){this.Assemblies[t]=e}filter(t){return this.Entities.filter(t)}generateName(t){return this.ids++,`${t.constructor.name}-${this.ids}`}get(t){return this.Entities.map[t]}setActive(t,e){const s=this.Entities.array.indexOf(t);if(e){if(s>=0)return;this.Entities.array.push(t)}else{if(s<0)return;this.Entities.array.splice(s,1)}}update(t,e,s=!1){const n=[],i=[];for(let a=0;a<this.Entities.array.length;a++){const r=this.Entities.array[a];r.update(t,e,s),r.dead?i.push(r):n.push(r)}for(let t=0;t<i.length;t++){const e=i[t];delete this.Entities.map[e.name],e.destroy()}this.Entities.array=n}}n.prototype.$Props={instance:0,isECSManager:!0};export{e as Component,s as Entity,n as Manager};
